---
layout:     post
title:      海南CT-Young校园网思路
subtitle:   海南电信校园网天翼校园
date:       2019-10-08
author:     浅唱
#header-img: /img/TIM截图20190810024626.png
catalog: true
tags:
    - 电脑
    - 工具
---

## 前言
入学时这边会帮注册一张电信手机卡用于连接校园网络，帐号就是手机号。    
这个ct-young是电信官方组建的校园网络，并非校园内部自行构建的网络。      

## 手机连接
手机连接校园网极为简单，因为新生统一办理的手机卡，大部分都是连号卡，看一下别人的号码最后几位改动一下就可以登录了。    
密码似乎是统一的，比如我们的是147258，帐号限制一个登录设备，两个手机就要用两个帐号登录。    
但是电脑的客户端是需要用了另外的客户端登录。    

## 电脑连接原理
电脑连接是难点，也是我们要攻克的对象。    
电脑使用另外的客户端连接，需要另外购买套餐，用手机的账号连接会提示终端不对，而且电脑的客户端会夜间断网。    
1.  首先我们发现手机短时间重连校园网时是不需要重复登录的，校园网的网关会有一个机制就是多长时间客户端无响应没有访问网络就退出登录。当你下一次你重新连接网络的时候就需要重新登录了。    
2.  ip地址是网关通过物理地址mac分配的，mac跟IP是有对应关系的，如果你强行设定静态ip去连接，网关检测出mac和ip不对应强行退出登录，因此这里我们就从物理地址mac下手。    
3.  电脑的网卡的mac地址修改不难，网上都有相应的方法，某些需要修改注册表，需要注意的是，win7以上系统的无线网卡的mac第二位必须为2，6，a，e，这里面原因比较复杂就不想详细解释了，博主试过很多方法都没能解决，而当前大部分都是win10系统，且我们的手机的mac地址第二位也不是26ae。网上的解决方法是安装xp的虚拟机，那就达不到我们需要的效果了，忽略。
4. 我这里是把手机的物理地址改为电脑的无线网卡物理地址，相对较为容易实现安卓手机需要root。root方法不多说了百度去查。    
下面附上一个安卓的mac一键修改器    

## 电脑连接方法     
我们将手机和电脑的物理地址mac设置相同之后，我们用手机连接校园网，注意此时电脑不能连接校园网，这个限制共享问题后面会讲到。    
手机连接好校园网之后正常进行登录，帐号就按刚才说的随便改动一下，密码统一的。    
手机登录好确定可以上网之后，我们关闭手机的wifi，直接关闭wifi防止自动连接。
此时电脑连接上校园网，这时候你会发现电脑已经可以连接网络了，至此大工告成。

## 限制共享
这几天一直在研究共享的方法，研究他的限制原理。今天终于理解了，因此连夜写文章生怕忘记。    
这里的限制共享是由旁路服务器审查流经客户端的流量，审查方法下面详细说明。被检测到共享，你的网络就会被冻结二十分钟。    
这几天看到群里有卖所谓的路由器，淘宝上也有，而且需要每个月缴纳加强防检测功能9.9元，我就搞不明白了，买了破解路由器为啥要每个月交钱？    
仔细想了想之后恍然大悟了，我之前一直是搭建内网的共享内网的代理。所以不管怎么弄都经过我的客户端转发流量，我的客户端再经过审查服务器的审查，所以永远也没用。    **后证实内网代理可以的**        
那这个所谓的加强防检测是怎么实现的呢，答案是他在路由器里有一个全局代理的客户端。把你所有的流量加密转发到外网搭建的代理服务器，再由服务器代理访问，因此路由器需要每个月缴纳服务器费就在这里了。        **这只是我的猜测，但是后面详细想一下应该不会用这种方法**    
这样为什么不会被检测到呢？因为代理服务器的连接是加密的，我内网搭建的代理虽然在两个客户端之间加密，但是我的作为服务器的客户端在转发的时候已经把他解密开转发了，因此会被检测到，如果加密转发到外网去再做转发就没法检测到了。
因此原理就是如此，在外网搭建一个代理服务器转发所有请求。      
**2019.10.14补充**          
这个方法是可以过检测的，检测原理是在客户端访问的时候注入cookie，然后请求某flash资源来检测，全局代理会把流量直接转发到外网客户端，不会被注入。        

## 共享弊端
本来直接可以连接的网站啊被你这么一转发绕圈子减缓网速，增加时延和丢包率，降低网络的质量。    
同时你需要具备一个带宽足够大的外网服务器才能支撑你的网速。    
9.9元一个月的服务器能有多好我不敢说，腾讯云1M最低配置的服务器一个月60元，这里得1M是带宽，换算成网速是128kb一秒。    
所以浪费钱意义也不大。因此在此推荐只用一个设备连接呢
**2019.10.14补充**          
因此我觉得破解路由器不是使用这种方法    

## 2019.10.08补充
今天在优化连接保持软件的时候把https连接改为http连接，因为https连接无法跳转，不便检测状态。
发现好多次http连接输出以下内容：    

	<html>
	<head>
	<script language="javascript">setTimeout("location.replace(location.href.split(\"#\")[0])",2000);</script>
	//两秒后刷新页面，不难得知检测周期是两秒
	<script type="text/javascript" src="http://1.1.1.3:89/cookie/flash.js"></script>
	//劫持搜集本地cookie
	<script language="javascript">setURL("1.1.1.3");supFlash("1187084036");</script>
	//分配一个变量 跟时间有关
	</head>
	<body>
	//后面都是在访问1.1.1.3的一些伪装成flash的内容，应该是检测的功能
	<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0" width="0" height="0" id="m" align="center"><param name="allowScriptAccess" value="always" />//对未支持flash的浏览器加入flash插件
	<param name="movie" value="http://1.1.1.3:89/cookie/flashcookie.swf" />
	//特别是这个，太可疑了
	<param name="quality" value="high" />
	<param name="FlashVars" value="srv=1.1.1.3" />
	<embed src="http://1.1.1.3:89/cookie/flashcookie.swf"FlashVars="srv=1.1.1.3" quality="high" width="0" height="0"  name="m" align="center" allowScriptAccess="always" type="application/x-shockwave-flash"pluginspage="http://www.macromedia.com/go/getflashplayer" />
	</object>
	</body></html>
	
[flash.js](/img/flash.js)  
我尝试禁止1.1.1.3来防止检测，发现同样还是会被冻结，可能是检测服务器反向检测客户端是否存活（猜测），因此不能禁止1.1.1.3。**（后发现分析有误）** 


## 2019.10.14补充    
今天又尝试一种新方法，我发现之前的猜测是正确的，检测服务器就是在1.1.1.3上。            
1.1.1.3对流量进行flash标记以此审查流量，审查是通过访问1.1.1.3:89上的资源进行审查的**注意http才会被审查，https无法被审查**。因此我们使用https代理把流量通过https的方式传输即可避免流量被标记审查。            
![QQ拼音截图20191014180009.png](https://fastly.jsdelivr.net/gh/qcnhy/img/QQ拼音截图20191014180009.png)
![QQ拼音截图20191014175919.png](https://fastly.jsdelivr.net/gh/qcnhy/img/QQ拼音截图20191014175919.png)
![QQ拼音截图20191014180040.png](https://fastly.jsdelivr.net/gh/qcnhy/img/QQ拼音截图20191014180040.png)
然后我们用别的设备通过wifi代理连接电脑搭建的服务端。    
![QQ拼音截图20191014180116.png](https://fastly.jsdelivr.net/gh/qcnhy/img/QQ拼音截图20191014180116.png)        
电脑的服务端CCproxy和客户端Proxifier以及安卓的服务端everyproxy和客户端postern都在 校园网https代理服务包内        
简单说下用法 首先要搭建服务端 电脑的服务端安装后点启动 默认端口808 手机的服务端安装好后勾选http/https后面的开关 默认端口1080    
电脑客户端见压缩文件里面的说明，手机的客户端**配置代理** 配置地址和端口下面选择https 删除用户名密码，然后左侧滑栏**配置规则**删去第一个 删去后点击唯一一个 动作改为通过代理连接，代理选择你刚才配置的那个选项。然后左侧滑栏**开启VPN**就可以了
**另外 尽量避免使用1080端口，因为他是专用的代理端口似乎有检测**

## 2019.10.17补充       
重新屡屡思路：
1. 1.1.1.3服务器的89端口分配td_cookie，并定向到flash资源，检测方式未知。    
2. 网关对http连接审查头部cookie，若发现分配给别的设备（mac和ip识别）的td_cookie（有记录对应的mac和ip）在不同的设备连接请求中，则冻结当前网络。    
因此，必须防火墙阻止1.1.1.3的89端口，整个ip都阻止也没事。另外，别的设备代理你的网络，要在他的浏览器清除所有cookie，因为所有的http连接都被注入td_cookie。**（重点）**        
所以最好就是，别的设备只通过你这个代理上网，一直打开代理软件，确保不被注入td_cookie    

## 遗留
因为手头没有路由器 没办法测试上述方法在路由器上可不可行，路由器的话就直接用iptables禁用1.1.1.3的89端口 有机会的朋友可以尝试一下     
还有网线也没有测试 有线连接没有研究 不过有线连接没法通过手机端登录基本没搞头 看看能否跟wifi互通代理wifi的手机 不过没啥用       

## 下载 
- [修改我的mac蓝奏云](https://wwcy.lanzouq.com/i6bbt0h)          
- [修改我的mac百度网盘](https://pan.baidu.com/s/1Kh0fUdRHZ9A8f_PJDV24wA) 提取码: k9vp      
- [校园网代理服务包蓝奏云](https://wwcy.lanzouq.com/i6th77g)             
- [校园网代理服务包百度网盘](https://pan.baidu.com/s/1TaFqdjx4nSGwpnjvB7vMSA) 提取码: hv83             
